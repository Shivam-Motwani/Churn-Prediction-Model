{% extends "base.html" %}

{% block title %}Predict Customer Churn{% endblock %}

{% block content %}
<div class="container my-5">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <div class="form-section p-5 fade-in-up">
                <h2 class="text-center mb-4">Customer Churn Prediction</h2>
                <p class="text-light text-center mb-5">Enter customer details to predict the likelihood of churn</p>
                
                <form id="prediction-form" method="POST">
                    <div class="row">
                        <!-- Personal Information -->
                        <div class="col-md-6 mb-3">
                            <label for="gender" class="form-label">Gender</label>
                            <select class="form-select" id="gender" name="gender" required>
                                <option value="">Select Gender</option>
                                <option value="Male">Male</option>
                                <option value="Female">Female</option>
                            </select>
                        </div>
                        
                        <div class="col-md-6 mb-3">
                            <label for="senior_citizen" class="form-label">Senior Citizen</label>
                            <select class="form-select" id="senior_citizen" name="senior_citizen" required>
                                <option value="">Select Status</option>
                                <option value="0">No</option>
                                <option value="1">Yes</option>
                            </select>
                        </div>
                        
                        <div class="col-md-6 mb-3">
                            <label for="partner" class="form-label">Partner</label>
                            <select class="form-select" id="partner" name="partner" required>
                                <option value="">Has Partner?</option>
                                <option value="Yes">Yes</option>
                                <option value="No">No</option>
                            </select>
                        </div>
                        
                        <div class="col-md-6 mb-3">
                            <label for="dependents" class="form-label">Dependents</label>
                            <select class="form-select" id="dependents" name="dependents" required>
                                <option value="">Has Dependents?</option>
                                <option value="Yes">Yes</option>
                                <option value="No">No</option>
                            </select>
                        </div>
                        
                        <div class="col-md-6 mb-3">
                            <label for="tenure" class="form-label">Tenure (months)</label>
                            <input type="number" class="form-control" id="tenure" name="tenure" min="0" max="100" required>
                            <div class="form-text text-light">Number of months the customer has stayed with the company</div>
                        </div>
                        
                        <!-- Service Information -->
                        <div class="col-md-6 mb-3">
                            <label for="phone_service" class="form-label">Phone Service</label>
                            <select class="form-select" id="phone_service" name="phone_service" required>
                                <option value="">Has Phone Service?</option>
                                <option value="Yes">Yes</option>
                                <option value="No">No</option>
                            </select>
                        </div>
                        
                        <div class="col-md-6 mb-3">
                            <label for="multiple_lines" class="form-label">Multiple Lines</label>
                            <select class="form-select" id="multiple_lines" name="multiple_lines" required>
                                <option value="">Multiple Lines?</option>
                                <option value="Yes">Yes</option>
                                <option value="No">No</option>
                                <option value="No phone service">No phone service</option>
                            </select>
                        </div>
                        
                        <div class="col-md-6 mb-3">
                            <label for="internet_service" class="form-label">Internet Service</label>
                            <select class="form-select" id="internet_service" name="internet_service" required>
                                <option value="">Internet Service Type</option>
                                <option value="DSL">DSL</option>
                                <option value="Fiber optic">Fiber optic</option>
                                <option value="No">No</option>
                            </select>
                        </div>
                        
                        <div class="col-md-6 mb-3">
                            <label for="online_security" class="form-label">Online Security</label>
                            <select class="form-select" id="online_security" name="online_security" required>
                                <option value="">Online Security?</option>
                                <option value="Yes">Yes</option>
                                <option value="No">No</option>
                                <option value="No internet service">No internet service</option>
                            </select>
                        </div>
                        
                        <div class="col-md-6 mb-3">
                            <label for="online_backup" class="form-label">Online Backup</label>
                            <select class="form-select" id="online_backup" name="online_backup" required>
                                <option value="">Online Backup?</option>
                                <option value="Yes">Yes</option>
                                <option value="No">No</option>
                                <option value="No internet service">No internet service</option>
                            </select>
                        </div>
                        
                        <div class="col-md-6 mb-3">
                            <label for="device_protection" class="form-label">Device Protection</label>
                            <select class="form-select" id="device_protection" name="device_protection" required>
                                <option value="">Device Protection?</option>
                                <option value="Yes">Yes</option>
                                <option value="No">No</option>
                                <option value="No internet service">No internet service</option>
                            </select>
                        </div>
                        
                        <div class="col-md-6 mb-3">
                            <label for="tech_support" class="form-label">Tech Support</label>
                            <select class="form-select" id="tech_support" name="tech_support" required>
                                <option value="">Tech Support?</option>
                                <option value="Yes">Yes</option>
                                <option value="No">No</option>
                                <option value="No internet service">No internet service</option>
                            </select>
                        </div>
                        
                        <div class="col-md-6 mb-3">
                            <label for="streaming_tv" class="form-label">Streaming TV</label>
                            <select class="form-select" id="streaming_tv" name="streaming_tv" required>
                                <option value="">Streaming TV?</option>
                                <option value="Yes">Yes</option>
                                <option value="No">No</option>
                                <option value="No internet service">No internet service</option>
                            </select>
                        </div>
                        
                        <div class="col-md-6 mb-3">
                            <label for="streaming_movies" class="form-label">Streaming Movies</label>
                            <select class="form-select" id="streaming_movies" name="streaming_movies" required>
                                <option value="">Streaming Movies?</option>
                                <option value="Yes">Yes</option>
                                <option value="No">No</option>
                                <option value="No internet service">No internet service</option>
                            </select>
                        </div>
                        
                        <!-- Account Information -->
                        <div class="col-md-6 mb-3">
                            <label for="contract" class="form-label">Contract</label>
                            <select class="form-select" id="contract" name="contract" required>
                                <option value="">Contract Type</option>
                                <option value="Month-to-month">Month-to-month</option>
                                <option value="One year">One year</option>
                                <option value="Two year">Two year</option>
                            </select>
                        </div>
                        
                        <div class="col-md-6 mb-3">
                            <label for="paperless_billing" class="form-label">Paperless Billing</label>
                            <select class="form-select" id="paperless_billing" name="paperless_billing" required>
                                <option value="">Paperless Billing?</option>
                                <option value="Yes">Yes</option>
                                <option value="No">No</option>
                            </select>
                        </div>
                        
                        <div class="col-md-6 mb-3">
                            <label for="payment_method" class="form-label">Payment Method</label>
                            <select class="form-select" id="payment_method" name="payment_method" required>
                                <option value="">Payment Method</option>
                                <option value="Electronic check">Electronic check</option>
                                <option value="Mailed check">Mailed check</option>
                                <option value="Bank transfer (automatic)">Bank transfer (automatic)</option>
                                <option value="Credit card (automatic)">Credit card (automatic)</option>
                            </select>
                        </div>
                        
                        <div class="col-md-6 mb-3">
                            <label for="monthly_charges" class="form-label">Monthly Charges ($)</label>
                            <input type="number" class="form-control" id="monthly_charges" name="monthly_charges" 
                                   step="0.01" min="0" max="200" required>
                            <div class="form-text text-light">Monthly charge amount in USD</div>
                        </div>
                        
                        <div class="col-12 mb-3">
                            <label for="total_charges" class="form-label">Total Charges ($)</label>
                            <input type="number" class="form-control" id="total_charges" name="total_charges" 
                                   step="0.01" min="0" required readonly>
                            <div class="form-text text-light">Automatically calculated as Tenure × Monthly Charges</div>
                            <div class="form-check mt-2">
                                <input class="form-check-input" type="checkbox" id="manual_total_charges">
                                <label class="form-check-label text-light" for="manual_total_charges">
                                    Manually edit total charges
                                </label>
                            </div>
                        </div>
                    </div>
                    
                    <div class="d-grid gap-2 mt-4">
                        <button type="submit" class="btn btn-warning btn-lg">
                            <i class="fas fa-chart-line me-2"></i>Predict Churn Probability
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Loading Modal -->
<div class="modal fade" id="loadingModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-body text-center p-5">
                <div class="spinner"></div>
                <h5 class="mt-3">Analyzing Customer Data...</h5>
                <p class="text-muted">Our AI model is processing the information</p>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    // Form submission with loading modal
    document.getElementById('prediction-form').addEventListener('submit', function(e) {
        // Show loading modal
        var loadingModal = new bootstrap.Modal(document.getElementById('loadingModal'));
        loadingModal.show();
    });

    // Auto-calculate total charges based on tenure and monthly charges
    document.getElementById('tenure').addEventListener('input', calculateTotalCharges);
    document.getElementById('monthly_charges').addEventListener('input', calculateTotalCharges);
    
    // Handle manual total charges checkbox
    document.getElementById('manual_total_charges').addEventListener('change', function() {
        const totalChargesField = document.getElementById('total_charges');
        if (this.checked) {
            totalChargesField.removeAttribute('readonly');
            totalChargesField.focus();
        } else {
            totalChargesField.setAttribute('readonly', true);
            calculateTotalCharges(); // Recalculate when switching back to auto
        }
    });

    function calculateTotalCharges() {
        const tenure = parseFloat(document.getElementById('tenure').value) || 0;
        const monthlyCharges = parseFloat(document.getElementById('monthly_charges').value) || 0;
        const totalChargesField = document.getElementById('total_charges');
        const manualCheckbox = document.getElementById('manual_total_charges');
        
        // Only auto-calculate if manual editing is not enabled
        if (!manualCheckbox.checked) {
            if (tenure >= 0 && monthlyCharges >= 0) {
                const calculatedTotal = tenure * monthlyCharges;
                totalChargesField.value = calculatedTotal.toFixed(2);
            } else {
                totalChargesField.value = '0.00';
            }
        }
    }
    
    // Initialize calculation on page load
    document.addEventListener('DOMContentLoaded', function() {
        calculateTotalCharges();
    });

    // Form validation feedback
    (function() {
        'use strict';
        window.addEventListener('load', function() {
            var forms = document.getElementsByClassName('needs-validation');
            var validation = Array.prototype.filter.call(forms, function(form) {
                form.addEventListener('submit', function(event) {
                    if (form.checkValidity() === false) {
                        event.preventDefault();
                        event.stopPropagation();
                    }
                    form.classList.add('was-validated');
                }, false);
            });
        }, false);
    })();
</script>
{% endblock %}
